<!DOCTYPE html>
<html>
<head>
	<title>FongMi - 智能解析服务</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- TVBOX 重定向 -->
	<script>
		// 立即检测并重定向
		(function() {
			const ua = navigator.userAgent.toLowerCase();
			const isTVBox = ua.includes('okhttp') || ua.includes('tvbox') || 
							ua.includes('catvod') || ua.includes('影视仓') ||
							ua.includes('androlua') || ua.includes('fongmi');
			
			// 检查URL参数
			const urlParams = new URLSearchParams(window.location.search);
			const hasTvBoxParam = urlParams.get('tvbox') || urlParams.get('catvod');
			
			if (isTVBox || hasTvBoxParam) {
				console.log('TVBOX 访问检测到，重定向到 data.json');
				// 使用replace避免回退到当前页
				window.location.replace('./data.json');
			}
		})();
	</script>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		body { 
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			max-width: 800px; 
			margin: 0 auto; 
			padding: 20px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: #e2e8f0;
			min-height: 100vh;
		}
		.header {
			text-align: center;
			margin-bottom: 20px;
			padding: 15px;
		}
		.header h1 {
			font-size: 1.6em;
			margin-bottom: 5px;
			color: white;
			font-weight: 600;
		}
		.header p {
			font-size: 0.9em;
			color: rgba(255,255,255,0.8);
		}
		.container {
			background: rgba(255, 255, 255, 0.1);
			padding: 18px;
			border-radius: 14px;
			margin: 12px 0;
			border: 1px solid rgba(255,255,255,0.2);
			backdrop-filter: blur(15px);
		}
		.url-box {
			background: rgba(255, 255, 255, 0.1);
			padding: 12px;
			border-radius: 10px;
			margin: 12px 0;
			text-align: center;
			border: 1px solid rgba(255,255,255,0.2);
		}
		.url-section {
			margin-bottom: 15px;
		}
		.url-label {
			font-size: 12px;
			color: rgba(255,255,255,0.9);
			margin-bottom: 5px;
			display: block;
		}
		.url {
			font-family: 'Courier New', monospace;
			font-size: 13px;
			color: white;
			word-break: break-all;
			margin: 8px 0;
			padding: 6px;
			background: rgba(255,255,255,0.1);
			border-radius: 6px;
			border: 1px solid rgba(255,255,255,0.2);
			cursor: pointer;
			transition: all 0.3s;
			position: relative;
		}
		.url:hover {
			background: rgba(255,255,255,0.15);
		}
		/* 复制成功状态 */
		.url.copied::after {
			content: "复制成功";
			position: absolute;
			right: 8px;
			top: 50%;
			transform: translateY(-50%);
			font-size: 10px;
			color: white;
			background: rgba(34, 197, 94, 0.6);
			padding: 2px 6px;
			border-radius: 4px;
		}
		.step {
			background: rgba(255, 255, 255, 0.1);
			padding: 10px 12px;
			border-radius: 8px;
			margin: 6px 0;
			display: flex;
			align-items: center;
			transition: all 0.2s;
			border: 1px solid rgba(255,255,255,0.1);
		}
		.step:hover {
			background: rgba(255, 255, 255, 0.15);
		}
		.step-number {
			background: rgba(255, 255, 255, 0.2);
			color: white;
			width: 22px;
			height: 22px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			margin-right: 10px;
			font-weight: 600;
			font-size: 11px;
			flex-shrink: 0;
			border: 1px solid rgba(255,255,255,0.3);
		}
		.step-content {
			flex: 1;
			font-size: 13px;
			color: white;
		}
		.download-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 12px;
			margin: 12px 0;
		}
		.download-item {
			background: rgba(255, 255, 255, 0.08);
			padding: 15px;
			border-radius: 10px;
			text-align: center;
			border: 1px solid rgba(255,255,255,0.1);
			transition: all 0.3s;
			cursor: pointer;
			position: relative;
		}
		.download-item:hover {
			background: rgba(255, 255, 255, 0.12);
			transform: translateY(-2px);
		}
		/* 下载中状态 */
		.download-item.downloading::after {
			content: "下载中...";
			position: absolute;
			top: 8px;
			right: 8px;
			font-size: 10px;
			color: white;
			background: rgba(59, 130, 246, 0.6);
			padding: 2px 6px;
			border-radius: 4px;
		}
		.download-icon {
			font-size: 1.8em;
			margin-bottom: 8px;
			display: block;
		}
		.download-item h4 {
			margin: 4px 0 6px 0;
			font-size: 14px;
			font-weight: 600;
			color: white;
		}
		.download-desc {
			font-size: 11px;
			color: rgba(255,255,255,0.8);
			line-height: 1.3;
		}
		.device-status {
			background: rgba(255, 255, 255, 0.1);
			border: 1px solid rgba(255,255,255,0.2);
			padding: 12px;
			border-radius: 8px;
			margin: 10px 0;
			text-align: center;
		}
		.device-status .icon {
			font-size: 1.5em;
			margin-bottom: 6px;
			display: block;
		}
		.device-info {
			background: rgba(255, 255, 255, 0.1);
			padding: 8px;
			border-radius: 6px;
			margin: 10px 0;
			font-size: 11px;
			text-align: center;
			color: rgba(255,255,255,0.9);
			border: 1px solid rgba(255,255,255,0.2);
		}
		.tips {
			background: rgba(255, 255, 255, 0.1);
			padding: 12px;
			border-radius: 8px;
			margin: 12px 0;
			border: 1px solid rgba(255,255,255,0.2);
		}
		.tip-item {
			margin: 4px 0;
			padding-left: 10px;
			position: relative;
			font-size: 12px;
			color: rgba(255,255,255,0.9);
		}
		.tip-item:before {
			content: "•";
			position: absolute;
			left: 0;
			color: rgba(255,255,255,0.8);
			font-weight: bold;
		}
		.footer {
			text-align: center;
			margin-top: 15px;
			padding-top: 12px;
			border-top: 1px solid rgba(255,255,255,0.2);
			font-size: 11px;
			color: rgba(255,255,255,0.7);
		}
		h3 {
			color: white;
			margin-bottom: 12px;
			font-size: 1em;
			font-weight: 600;
			text-align: center;
		}
		
		/* 黑色风格Toast提示 */
		.toast {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: rgba(0, 0, 0, 0.9);
			color: white;
			padding: 14px 20px;
			border-radius: 10px;
			font-size: 13px;
			z-index: 1000;
			backdrop-filter: blur(10px);
			border: 1px solid rgba(255,255,255,0.2);
			box-shadow: 0 8px 25px rgba(0,0,0,0.3);
			animation: toastFade 2s ease-in-out forwards;
			text-align: center;
		}
		@keyframes toastFade {
			0% { opacity: 0; transform: translate(-50%, -20px); }
			20% { opacity: 1; transform: translate(-50%, -50%); }
			80% { opacity: 1; transform: translate(-50%, -50%); }
			100% { opacity: 0; transform: translate(-50%, -80px); }
		}
		
		.test-links {
			text-align: center;
			margin: 10px 0;
		}
		.test-link {
			color: rgba(255,255,255,0.8);
			font-size: 11px;
			text-decoration: none;
			margin: 0 5px;
			padding: 2px 6px;
			border: 1px solid rgba(255,255,255,0.3);
			border-radius: 4px;
			transition: all 0.3s;
		}
		.test-link:hover {
			background: rgba(255,255,255,0.1);
			color: white;
		}
		.status-info {
			font-size: 11px;
			color: rgba(255,255,255,0.8);
			margin-top: 4px;
		}
		.action-hint {
			font-size: 10px;
			color: rgba(255,255,255,0.6);
			text-align: center;
			margin-top: 8px;
		}
	</style>
</head>
<body>
	<div class="header">
		<h1>🎬 FongMi 智能解析服务</h1>
		<p>同一网址，智能识别客户端类型 • 提供软件下载</p>
		<div class="test-links">
			<a href="?debug=1" class="test-link">调试模式</a>
			<a href="?tvbox=1" class="test-link">模拟TVBox</a>
			<a href="./data.json" class="test-link">直接查看JSON</a>
		</div>
	</div>

	<!-- 使用教程 -->
	<div class="container">
		<h3>📖 使用教程</h3>
		
		<div class="step">
			<div class="step-number">1</div>
			<div class="step-content">复制下方任一地址</div>
		</div>
		
		<div class="url-box">
			<div class="url-section">
				<span class="url-label">🎯 智能地址（推荐）：</span>
				<div class="url" id="serviceUrl" onclick="copyServiceUrl(this)">加载中...</div>
				<div class="action-hint">点击上方链接即可复制</div>
			</div>
			
			<div class="url-section">
				<span class="url-label">📄 直接数据地址：</span>
				<div class="url" id="jsonUrl" onclick="copyJsonUrl(this)">加载中...</div>
				<div class="action-hint">点击上方链接即可复制</div>
			</div>
		</div>
		
		<div class="step">
			<div class="step-number">2</div>
			<div class="step-content">打开 TVBOX 或 FongMi 应用</div>
		</div>
		
		<div class="step">
			<div class="step-number">3</div>
			<div class="step-content">在配置地址中粘贴网址</div>
		</div>
		
		<div class="step">
			<div class="step-number">4</div>
			<div class="step-content">点击确定开始使用</div>
		</div>
	</div>

	<!-- 软件下载 -->
	<div class="container">
		<h3>📥 软件下载</h3>
		<div class="download-grid">
			<div class="download-item" onclick="downloadApp('fongmi', this)">
				<span class="download-icon">📱</span>
				<h4>FongMi 定制版</h4>
				<div class="download-desc">基于官方版本优化，支持更多功能</div>
			</div>
			
			<div class="download-item" onclick="downloadApp('tvbox', this)">
				<span class="download-icon">📺</span>
				<h4>TVBox 定制版</h4>
				<div class="download-desc">多版本适配，播放体验更流畅</div>
			</div>
		</div>
		<div class="action-hint">点击上方卡片即可下载对应软件</div>
	</div>

	<!-- 设备检测 -->
	<div class="container">
		<h3>🔍 设备检测</h3>
		<div class="device-status">
			<span class="icon">🌐</span>
			<strong>当前访问模式：<span id="accessMode">浏览器</span></strong>
			<div class="status-info">显示引导页面 • 智能识别客户端</div>
		</div>
		<div class="device-info">
			已支持：TVBOX、FongMi、影视仓、CatVod等客户端自动识别
		</div>
	</div>

	<!-- 温馨提示 -->
	<div class="container tips">
		<h3>💡 温馨提示</h3>
		<div class="tip-item">智能识别：浏览器显示页面，TVBOX返回数据</div>
		<div class="tip-item">如智能地址无效，请使用直接数据地址</div>
		<div class="tip-item">请将地址配置到TVBOX的数据源设置中</div>
		<div class="tip-item">请勿相信视频中的任何付费广告</div>
	</div>

	<div class="footer">
		FongMi 智能解析服务 © 2024
	</div>

	<script>
		// 自动生成网址
		function getBaseUrl() {
			const path = window.location.pathname;
			const basePath = path.substring(0, path.lastIndexOf('/') + 1);
			return window.location.origin + basePath;
		}
		
		const baseUrl = getBaseUrl();
		const serviceUrl = baseUrl;
		const jsonUrl = baseUrl + 'data.json';
		
		document.getElementById('serviceUrl').textContent = serviceUrl;
		document.getElementById('jsonUrl').textContent = jsonUrl;
		
		// 增强版 TVBOX 检测函数
		function isTVBoxUserAgent() {
			const ua = navigator.userAgent.toLowerCase();
			
			// 更全面的 TVBOX 检测列表
			const tvboxIndicators = [
				'okhttp', 'tvbox', 'catvod', 'tang', '影视仓',
				'androlua', 'lua', 'p2p', 'tv.player', 'tv/',
				'android.tv', 'tvos', 'smarttv', 'fongmi'
			];
			
			// 检测URL参数（有些TVBox通过参数标识）
			const urlParams = new URLSearchParams(window.location.search);
			if (urlParams.get('tvbox') || urlParams.get('catvod')) {
				return true;
			}
			
			// 严格检测：必须包含 TVBOX 相关关键词
			for (let indicator of tvboxIndicators) {
				if (ua.includes(indicator)) {
					console.log('检测到 TVBOX 标识:', indicator);
					return true;
				}
			}
			
			return false;
		}
		
		// 显示调试信息
		function showDebugInfo() {
			const debugInfo = `
UserAgent: ${navigator.userAgent}
检测结果: ${isTVBoxUserAgent() ? 'TVBox客户端' : '浏览器'}
完整URL: ${window.location.href}
时间: ${new Date().toLocaleString()}
			`.trim();
			
			// 只在URL有debug参数时显示
			const urlParams = new URLSearchParams(window.location.search);
			if (urlParams.get('debug')) {
				const debugEl = document.createElement('div');
				debugEl.className = 'device-info';
				debugEl.innerHTML = `<pre style="font-size:10px;text-align:left;white-space:pre-wrap;">${debugInfo}</pre>`;
				document.querySelector('.device-status').after(debugEl);
				
				// 更新访问模式显示
				document.getElementById('accessMode').textContent = 
					isTVBoxUserAgent() ? 'TVBox客户端' : '浏览器 (调试模式)';
			}
			
			console.log('FongMi Debug Info:', debugInfo);
		}
		
		// 黑色Toast提示
		function showToast(message) {
			const toast = document.createElement('div');
			toast.className = 'toast';
			toast.textContent = message;
			document.body.appendChild(toast);
			
			setTimeout(() => {
				if (toast.parentNode) {
					document.body.removeChild(toast);
				}
			}, 2000);
		}
		
		// 复制功能 - 点击链接即可复制
		async function copyServiceUrl(element) {
			await copyToClipboard(serviceUrl, '智能服务地址', element);
		}
		
		async function copyJsonUrl(element) {
			await copyToClipboard(jsonUrl, '直接数据地址', element);
		}
		
		async function copyToClipboard(text, type, element) {
			try {
				// 显示复制成功状态（3秒后消失）
				element.classList.add('copied');
				
				if (navigator.clipboard && window.isSecureContext) {
					await navigator.clipboard.writeText(text);
				} else {
					// 降级方案
					const textArea = document.createElement('textarea');
					textArea.value = text;
					document.body.appendChild(textArea);
					textArea.select();
					document.execCommand('copy');
					document.body.removeChild(textArea);
				}
				
				showToast(`${type}复制成功！\n请到TVBOX配置中粘贴使用`);
				
				// 3秒后恢复原始状态
				setTimeout(() => {
					element.classList.remove('copied');
				}, 3000);
				
			} catch (err) {
				console.error('复制失败:', err);
				showToast(`${type}复制失败，请手动复制地址`);
				element.classList.remove('copied');
			}
		}
		
		// 下载应用功能 - 配置您的下载链接
		function downloadApp(type, element) {
			// 显示下载中状态（3秒后消失）
			element.classList.add('downloading');
			
			// 在这里配置您的GitHub下载链接
			const downloadLinks = {
				'fongmi': 'https://github.com/您的用户名/fongmi-releases/releases',
				'tvbox': 'https://github.com/您的用户名/tvbox-releases/releases'
			};
			
			const url = downloadLinks[type];
			
			if (url && !url.includes('您的用户名')) {
				// 有有效链接，直接下载
				setTimeout(() => {
					window.open(url, '_blank');
					// 3秒后恢复原始状态
					setTimeout(() => {
						element.classList.remove('downloading');
					}, 3000);
				}, 500);
			} else {
				// 没有配置链接，显示提示
				showToast('该版本正在努力开发中，敬请期待！');
				// 3秒后恢复原始状态
				setTimeout(() => {
					element.classList.remove('downloading');
				}, 3000);
			}
		}
		
		// 初始化
		function init() {
			showDebugInfo();
			
			// 如果是TVBOX访问，立即重定向到JSON数据
			if (isTVBoxUserAgent()) {
				console.log('TVBOX 访问检测到，重定向到 data.json');
				window.location.replace('./data.json');
			}
		}
		
		// 页面加载完成后初始化
		document.addEventListener('DOMContentLoaded', init);
	</script>
</body>
</html>