<?php
// 如果是PHP环境，可以设置header
header('Content-Type: application/json');

$isTVBox = false;
$userAgent = $_SERVER['HTTP_USER_AGENT'] ?? '';

if (strpos($userAgent, 'okhttp') !== false || 
    strpos($userAgent, 'tvbox') !== false ||
    isset($_GET['tvbox'])) {
    $isTVBox = true;
}

if ($isTVBox) {
    $response = [
        "guide" => [
            "redirect_to" => "./data.json",
            "message" => "FongMi智能解析服务",
            "instructions" => "请在TVBox配置中使用下方地址"
        ]
    ];
    echo json_encode($response, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);
    exit;
} else {
    header('Location: ./guide.html');
    exit;
}
?>

<!-- HTML备用方案 -->
<script>
// 如果PHP不支持，使用JavaScript方案
const ua = navigator.userAgent.toLowerCase();
const isTVBox = ua.includes('okhttp') || ua.includes('tvbox') || new URLSearchParams(window.location.search).has('tvbox');

if (isTVBox) {
    const response = {
        "fongmi_redirect": {
            "target": "./data.json",
            "message": "请使用此地址配置TVBox",
            "status": "success"
        }
    };
    document.write(JSON.stringify(response, null, 2));
} else {
    window.location.href = './guide.html';
}
</script>